(()=>{"use strict";const t={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};class e{constructor(){this.keyCode=t,this.keyEvent={keyDown:{},keyUp:{}},this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}static getInstance(){return e.instance||(e.instance=new e),e.instance}start(){window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}hasKeyDown(t){return!0===this.keyEvent.keyDown[t]}hasKeyUp(t){return!0===this.keyEvent.keyUp[t]}handleKeyDown(t){this.hasKeyDown(t.which)||(this.keyEvent.keyDown[t.which]=!0)}handleKeyUp(t){this.keyEvent.keyUp[t.which]=!0,delete this.keyEvent.keyDown[t.which]}}class i{constructor(){this.canvas=document.getElementById("game")}static getInstance(){return i.instance||(i.instance=new i),i.instance}getContext(){return this.ctx}getCanvas(){return this.canvas}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}init(t,e){return this.canvas.width=t,this.canvas.height=e,this.canvas}}class s{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}getY(){return this.y}setX(t){this.x=t}setY(t){this.y=t}static add(t,e){return new s(t.getX()+e.getX(),t.getY()+e.getY())}static sub(t,e){return new s(t.getX()-e.getX(),t.getY()-e.getY())}static mul(t,e){return new s(t.getX()*e,t.getY()*e)}static distance(t,e){return Math.sqrt(Math.pow(t.getX()-e.getX(),2)+Math.pow(t.getY()-e.getY(),2))}}const n=i.getInstance().init(600,1400),h=n.getContext("2d"),a="running",r="jumping",o="falling",g="crouch";new s(0,n.height-1050);class c{constructor(){this.isActive=!0,this.isEnabled=!0,this.gameCore=G,this.canvas=G.canvas.getCanvas()}setToggleActive(t){t&&!this.isEnabled?this.isEnabled=!0:!t&&this.isEnabled&&(this.isEnabled=!1)}reset(){}}class m extends c{constructor(t){super(),this.gameObject=t,this.gameObject.addComponent(this)}getName(){return this.name}setName(t){this.name=t}}class d extends m{constructor(t){super(t),this.width=t.getWidth(),this.height=t.getHeight(),this.pos=t.getPos(),this.name="Collider"}getWidth(){return this.width}getHeight(){return this.height}setWidth(t){this.width=t}setHeight(t){this.height=t}getPosition(){return this.pos}setPosition(t){this.pos=t}isCollidingWith(t){return t.getPosition().getX()<this.pos.getX()+this.width&&t.getPosition().getX()+t.getWidth()>this.pos.getX()&&t.getPosition().getY()<this.pos.getY()+this.height&&t.getHeight()+t.getPosition().getY()>this.pos.getY()}update(t,e){}render(t){}}class u extends c{constructor(t=new s(0,0),e=0){super(),this.components=[],this.position=t,this.depth=e}getPos(){return this.position}setPos(t){this.position=t}getWidth(){return this.width}getHeight(){return this.height}setWidth(t){this.width=t}setHeight(t){this.height=t}getDepth(){return this.depth}setDepth(t){this.depth=t}setToggleActive(t){if(t&&!this.isEnabled){for(let t of this.components)t.setToggleActive(!0);this.isEnabled=!0}else if(!t&&this.isEnabled){for(let t of this.components)t.setToggleActive(!1);this.isEnabled=!1}}addComponent(t){this.components.push(t)}getComponent(t){for(let e of this.components)if(e.getName()===t)return e}}class p extends u{constructor(){super()}getImage(){return this.image}setImage(t){this.image=t}render(){h.drawImage(this.image,this.position.getX(),this.position.getY())}}class w extends m{constructor(t){super(t),this.gravity=.067,this.velocity=new s(0,0),this.land=this.canvas.height-this.gameObject.getHeight(),this.name="Physic"}update(t){console.log(this.gravity*t),this.velocity=s.add(this.velocity,new s(0,this.gravity*t)),this.gameObject.setPos(s.add(this.gameObject.getPos(),this.velocity)),this.gameObject.getPos().getY()>=this.land&&(this.gameObject.getPos().setY(this.land),this.velocity=new s(0,0))}render(t){}}class l extends m{constructor(t,e){super(t),this.name="Animation",this.animatiomTimer=200,this.animationFrame={},this.animationFrameIndex=0,this.sprite=e}getAnimationName(){return this.animationNameRunning}addAnimationFrame(t,e){this.animationFrame[t]||(this.animationFrame[t]=[]),this.animationFrame[t].push(e)}play(t,e,i){t!==this.animationNameRunning&&(this.animationNameRunning=t,this.animationFrameIndex=0),this.update(e,i)}update(t,e){this.animatiomTimer<=0&&(this.sprite.setImage(this.animationFrame[this.animationNameRunning][this.animationFrameIndex]),this.animationFrameIndex=(this.animationFrameIndex+1)%this.animationFrame[this.animationNameRunning].length,this.animatiomTimer=100),this.animatiomTimer-=t*e}render(t){}}const y=new Image;y.src="./assets/images/standing_still.png";const C=new Image;C.src="./assets/images/dino_run1.png";const b=new Image;b.src="./assets/images/dino_run2.png";const S=new Image;S.src="./assets/images/crouch_1.png";const E=new Image;E.src="./assets/images/crouch_2.png";const I=new Image;I.src="./assets/images/standing_still_eye_closed.png";class D extends p{constructor(){super(),this.image=y,this.width=this.image.width,this.height=this.image.height,this.state=a,this.position=new s(10,this.canvas.height-this.height),this.physic=new w(this),this.animation=new l(this,this),this.animation.addAnimationFrame("RUNNING",C),this.animation.addAnimationFrame("RUNNING",b),this.animation.addAnimationFrame("CROUCH",S),this.animation.addAnimationFrame("CROUCH",E),this.collider=new d(this)}update(t,e){switch(this.state){case a:this.animation.play("RUNNING",t,e),G.inputManager.hasKeyDown(G.inputManager.keyCode.SPACE)||G.inputManager.hasKeyDown(G.inputManager.keyCode.UP)?(this.image=I,this.state=r,this.physic.velocity.setY(-20)):G.inputManager.hasKeyDown(G.inputManager.keyCode.DOWN)&&(this.image=S,this.state=g,this.resetPos()),this.resetPos();break;case r:G.inputManager.hasKeyDown(G.inputManager.keyCode.DOWN)&&(this.physic.velocity.setY(this.physic.velocity.getY()+this.physic.gravity*t*10),this.state=o),G.inputManager.hasKeyDown(G.inputManager.keyCode.DOWN)&&G.inputManager.hasKeyDown(G.inputManager.keyCode.SPACE)&&(this.image=S,this.resetPos(),this.state=g),this.physic.update(t),this.physic.velocity.getY()>=0&&(this.state=o);break;case o:this.physic.update(t),G.inputManager.hasKeyDown(G.inputManager.keyCode.DOWN)&&(this.physic.velocity.setY(this.physic.velocity.getY()+this.physic.gravity*t*10),this.state=o),this.position.getY()>=this.physic.land&&(this.image=C,this.state=a);break;case g:G.inputManager.hasKeyDown(G.inputManager.keyCode.DOWN)||(this.image=y,this.state=a,this.resetPos()),this.animation.play("CROUCH",t,e),this.resetPos()}}resetPos(){this.width=this.image.width,this.height=this.image.height,this.position=new s(this.position.getX(),this.canvas.height-this.height)}}const O=new Image;O.src="./assets/images/ground.png";class v extends p{constructor(){super(),this.width=O.width,this.height=O.height,this.position=new s(0,this.canvas.height-this.height),this.image=O}update(t,e){this.position.setX(this.position.getX()-e*t),this.position.getX()<=-this.width&&this.position.setX(0)}render(){h.drawImage(this.image,this.position.getX(),this.position.getY(),this.width,this.height),h.drawImage(this.image,this.position.getX()+this.width,this.position.getY(),this.width,this.height)}}class P{constructor(){this.gameObjects=[]}addGameObject(t){this.gameObjects.push(t)}getGameObjects(){return this.gameObjects}}const M=new Image;M.src="./assets/images/cloud.png";class N extends p{constructor(t){super(),this.position=t,this.width=M.width,this.height=M.height,this.image=M}update(t,e){let i=this.position.getX();if(i-=e*t*e*.5,this.position.setX(i),this.position.getX()<=-this.width){let t=this.width+window.innerWidth;this.position.setX(t)}}}class j extends p{constructor(t,e){super(),this.digit=e,this.position=t,this.image=new Image,this.setDigit(e)}setDigit(t){this.digit=t,this.image.src=`./assets/images/number/${this.digit}_digit.png`}update(t,e){throw new Error("Method not implemented.")}}const f="highScore";class X extends p{constructor(t,e=5){super(),this.length=e,this.listDigit=[],this.position=t,this.highScore=window.Number(localStorage.getItem(f))||0,this.incrementCounter=0;for(let i=0;i<e;i++)this.listDigit.push(new j(new s(this.position.getX()+25*i,t.getY()),0));this.num=0,this.formattedNumber=this.stringToNumber(this.num)}stringToNumber(t){return t.toLocaleString("en-US",{minimumIntegerDigits:this.length,useGrouping:!1})}setNumber(t){this.num=t,this.formattedNumber=this.stringToNumber(this.num);for(let t=0;t<this.length;t++)this.listDigit[t].setDigit(parseInt(this.formattedNumber[t]));this.num>this.highScore&&(this.highScore=this.num,localStorage.setItem(f,this.highScore.toString()))}getHighScore(){return this.highScore}update(t,e){this.incrementCounter+=t*e*.02,this.incrementCounter>=1&&(this.incrementCounter=0,this.num+=1,this.setNumber(this.num))}render(){for(let t of this.listDigit)t.render()}}class A extends p{constructor(t,e){super(),this.character=e,this.position=t,this.image=new Image,this.image.src=`./assets/images/${this.character}_character.png`}setCharacter(t){this.character=t,this.image.src=`./assets/images/${this.character}_character.png`}update(t,e){throw new Error("Method not implemented.")}}class k extends p{constructor(t){super(),this.position=t,this.hChar=new A(new s(this.position.getX(),this.position.getY()),"H"),this.iChar=new A(new s(this.position.getX()+22,this.position.getY()),"I"),this.highScore=Number(localStorage.getItem("highScore"))||0}update(t,e){}render(){this.hChar.render(),this.iChar.render();const t=this.highScore.toString().padStart(5,"0");let e=65;for(let i=0;i<t.length;i++){const n=t[i];new j(new s(this.position.getX()+e,this.position.getY()),parseInt(n)).render(),e+=25}}}class x extends P{load(){this.ground=new v,this.player=new D,this.score=new X(new s(n.width-150,50),5),this.cloud=new N(new s(n.width,50)),this.highScore=new k(new s(n.width-400,50)),this.cloud=new N(new s(n.width-50,100)),this.cloud1=new N(new s(n.width-250,130)),this.cloud2=new N(new s(n.width-120,200)),this.addGameObject(this.player),this.addGameObject(this.ground),this.addGameObject(this.cloud),this.addGameObject(this.cloud1),this.addGameObject(this.cloud2),this.addGameObject(this.score),this.addGameObject(this.highScore)}update(t,e){}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render()}unload(){}}class Y{constructor(){this.state=1,this.setCurrentScene(new x),this.canvas=i.getInstance(),this.inputManager=e.getInstance()}static getInstacne(){return Y.instance?Y.instance:Y.instance=new Y}start(t,e,i){this.canvas.init(t,e),this.inputManager.start(),this.currentScene.load()}clearScreen(){h.fillStyle="white",h.fillRect(0,0,n.width,n.height)}update(t,e){this.currentScene.update(t,e)}render(){this.clearScreen(),this.currentScene.render()}changeScene(t){this.currentScene.unload(),this.setCurrentScene(t),this.currentScene.load()}getCurrentScene(){return this.currentScene}setCurrentScene(t){this.currentScene=t}}const G=new Y;class U extends P{constructor(){super()}load(){this.player=new D,this.ground=new v,this.score=new X(new s(n.width-150,50),5),this.cloud=new N(new s(n.width-50,100)),this.cloud1=new N(new s(n.width-250,130)),this.cloud2=new N(new s(n.width-120,200)),this.highScore=new k(new s(n.width-400,50)),this.addGameObject(this.highScore),this.addGameObject(this.ground),this.addGameObject(this.cloud),this.addGameObject(this.cloud1),this.addGameObject(this.cloud2),this.addGameObject(this.score),this.addGameObject(this.player)}update(t,e){for(let i=0;i<this.gameObjects.length;i++)this.gameObjects[i].update(t,e)}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render()}unload(){}}const K=new Image;K.src="./assets/images/replay.png";const F=new Image;F.src="./assets/images/game_over.png";class T extends P{constructor(t){super(),this.gameObjects=t}load(){}update(t,e){}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render();this.renderGameOver()}renderGameOver(){h.drawImage(F,n.width/2-180,n.height/2-50),h.drawImage(K,n.width/2-25,n.height/2)}unload(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].setToggleActive(!1)}}class W extends p{constructor(){super(),this.collider=new d(this)}update(t,e){this.position.setX(this.position.getX()-e*t)}}const _=new Image;_.src="./assets/images/bird_1.png";const H=new Image;H.src="./assets/images/bird_2.png";class R extends W{constructor(t,e){super(),this.position=t,this.depth=e,this.image=_,this.width=_.width,this.height=_.height,this.animation=new l(this,this),this.animation.addAnimationFrame("FLY",_),this.animation.addAnimationFrame("FLY",H)}update(t,e){this.fly(t,e),this.position.setX(this.position.getX()-e*t*1.3)}fly(t,e){this.animation.play("FLY",t,e)}}class L extends W{constructor(t){super(),this.depth=t;let e=new Image;e.src="./assets/images/cactus_"+String(Math.floor(3*Math.random())+1)+".png",this.image=e,this.width=this.image.width,this.height=this.image.height,this.position=new s(1.5*this.canvas.width,this.canvas.height-this.height)}update(t,e){this.position.setX(this.position.getX()-e*t),this.getPos().getX()<=-this.width&&this.getPos().setX(this.width+window.innerWidth)}}class B{constructor(){this.enemies=[],this.maxEnemies=5,this.currentEnemies=0}static getInstance(){return B.instance||(B.instance=new B),B.instance}generateEnemy(t){this.currentEnemies>=this.maxEnemies&&(this.enemies.shift(),this.currentEnemies--);const e=new s(n.width,500*Math.random()),i=new R(e,t);if(this.enemies.push(i),this.currentEnemies++,!this.enemies.some((t=>t instanceof L))){const e=new L(t);this.enemies.push(e),this.currentEnemies++}}update(t,e){for(let i=0;i<this.enemies.length;i++){const s=this.enemies[i];s.update(t,e),s.getPos().getX()<-s.getWidth()&&(this.removeEnemy(s),i--)}}clearEnemies(){this.enemies=[],this.currentEnemies=0}removeEnemy(t){const e=this.enemies.indexOf(t);e>-1&&(this.enemies.splice(e,1),this.currentEnemies--)}render(){for(const t of this.enemies)t.render()}}const $=B.getInstance(),q=new Image;q.src="./assets/images/die.png";class V{constructor(){this.gameCore=G,this.gameCore.start(1400,600,new U),this.gameSpeed=.7,this.timeSinceLastEnemy=0,this.minTimeBetweenEnemies=3e3}static getInstance(){return V.instance||(V.instance=new V),V.instance}updateGameSpeed(){this.gameSpeed+=1e-4}update(t){switch(this.gameCore.state){case 1:(this.gameCore.inputManager.hasKeyDown(this.gameCore.inputManager.keyCode.SPACE)||this.gameCore.inputManager.hasKeyDown(this.gameCore.inputManager.keyCode.UP))&&(this.gameCore.state=2,this.gameCore.changeScene(new U)),this.gameCore.update(0,0);break;case 2:this.updateGameSpeed(),this.gameCore.update(t,this.gameSpeed),this.timeSinceLastEnemy+=t,this.gameCore.getCurrentScene().getGameObjects();const e=this.gameCore.getCurrentScene().getGameObjects().find((t=>t instanceof D)),i=e.getComponent("Collider");i&&$.enemies.forEach((t=>{const s=t.getComponent("Collider");s.setHeight(t.getHeight()),s.setWidth(t.getWidth()),s.setPosition(t.getPos()),i.setHeight(e.getHeight()),i.setWidth(e.getWidth()),i.setPosition(e.getPos()),i.isCollidingWith(s)&&(this.gameCore.state=3,e.setImage(q),this.gameCore.changeScene(new T(this.gameCore.getCurrentScene().getGameObjects())),this.gameCore.getCurrentScene().unload())})),this.timeSinceLastEnemy>=this.minTimeBetweenEnemies&&($.generateEnemy(this.gameSpeed),this.timeSinceLastEnemy=0),$.update(t,this.gameSpeed);break;case 3:(this.gameCore.inputManager.hasKeyDown(this.gameCore.inputManager.keyCode.SPACE)||this.gameCore.inputManager.hasKeyDown(this.gameCore.inputManager.keyCode.UP))&&(this.gameCore.state=2,$.enemies=[],this.gameCore.changeScene(new U),this.resetGame()),this.gameCore.update(0,0)}}resetGame(){this.gameSpeed=.7}render(){this.gameCore.render(),$.render()}}const z=V.getInstance();!function t(e){const i=Date.now();z.render(),z.update(i-e),e=Date.now(),requestAnimationFrame((()=>t(e)))}(Date.now())})();