(()=>{"use strict";const t={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};class e{constructor(){this.keyCode=t,this.keyEvent={keyDown:{},keyUp:{}},this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}static getInstance(){return e.instance||(e.instance=new e),e.instance}start(){window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}hasKeyDown(t){return!0===this.keyEvent.keyDown[t]}hasKeyUp(t){return!0===this.keyEvent.keyUp[t]}handleKeyDown(t){this.hasKeyDown(t.which)||(this.keyEvent.keyDown[t.which]=!0)}handleKeyUp(t){this.keyEvent.keyUp[t.which]=!0,delete this.keyEvent.keyDown[t.which]}}class s{constructor(){}static getInstance(){return s.instance?s.instance:s.instance=new s}loadScene(t){this.currentScene&&this.currentScene.unload(),this.currentScene=t,this.currentScene.load()}update(t,e){this.currentScene.update(t,e)}render(){this.currentScene.render()}getCurrentScene(){return this.currentScene}}class i{constructor(){this.canvas=document.getElementById("game")}static getInstance(){return i.instance||(i.instance=new i),i.instance}getContext(){return this.ctx}getCanvas(){return this.canvas}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}init(t,e){return this.canvas.width=t,this.canvas.height=e,this.canvas}}function n(){const t=Math.min(window.innerHeight,document.documentElement.clientHeight),e=Math.min(window.innerWidth,document.documentElement.clientWidth);return e/t<h.game.GAME_WIDTH/h.game.GAME_HEIGHT?e/h.game.GAME_WIDTH:t/h.game.GAME_HEIGHT}var h={game:{GAME_WIDTH:800,GAME_HEIGHT:300,GAME_SPEED:1,GAME_SPEED_INCREMENT:1e-5,GROUND_AND_CACTUS_SPEED:.5},player:{PLAYER_WIDTH:58,PLAYER_HEIGHT:62,JUMP_HEIGHT:200,JUMP_SPEED:.6,GRAVITY:.4},ground:{GROUND_WIDTH:2400,GROUND_HEIGHT:24},cactus:{CACTUS_WIDTH:45,CACTUS_HEIGHT:30}};const a=n(),o=i.getInstance().init(200*a,810*a),c=o.getContext("2d");class r{constructor(){this.state=1,this.canvas=i.getInstance(),this.inputManager=e.getInstance(),this.sceneManager=s.getInstance()}static getInstacne(){return r.instance?r.instance:r.instance=new r}start(t,e,s){this.canvas.init(t,e),this.inputManager.start(),this.sceneManager.loadScene(s)}clearScreen(){c.fillStyle="white",c.fillRect(0,0,o.width,o.height)}update(t,e){this.sceneManager.update(t,e)}render(){this.clearScreen(),this.sceneManager.render()}}const g=new r;class d{constructor(){this.isActive=!0,this.isEnabled=!0,this.gameCore=g,this.canvas=g.canvas.getCanvas()}setToggleActive(t){t&&!this.isEnabled?this.isEnabled=!0:!t&&this.isEnabled&&(this.isEnabled=!1)}reset(){}}class l{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}getY(){return this.y}setX(t){this.x=t}setY(t){this.y=t}static add(t,e){return new l(t.getX()+e.getX(),t.getY()+e.getY())}static sub(t,e){return new l(t.getX()-e.getX(),t.getY()-e.getY())}static mul(t,e){return new l(t.getX()*e,t.getY()*e)}static distance(t,e){return Math.sqrt(Math.pow(t.getX()-e.getX(),2)+Math.pow(t.getY()-e.getY(),2))}}class m extends d{constructor(t=new l(0,0),e=0){super(),this.components=[],this.position=t,this.depth=e}getPos(){return this.position}setPos(t){this.position=t}getWidth(){return this.width}getHeight(){return this.height}setWidth(t){this.width=t}setHeight(t){this.height=t}getDepth(){return this.depth}setDepth(t){this.depth=t}setToggleActive(t){if(t&&!this.isEnabled){for(let t of this.components)t.setToggleActive(!0);this.isEnabled=!0}else if(!t&&this.isEnabled){for(let t of this.components)t.setToggleActive(!1);this.isEnabled=!1}}addComponent(t){this.components.push(t)}getComponent(t){for(let e of this.components)if(e.getName()===t)return e}}class u extends m{constructor(){super()}}class p extends d{constructor(t){super(),this.gameObject=t,this.gameObject.addComponent(this)}getName(){return this.name}setName(t){this.name=t}}class w extends p{constructor(t,e){super(t),this.gravity=10*e,this.velocity=new l(0,-this.gravity),this.land=this.canvas.height-this.gameObject.getHeight()-1.5*e}update(t){this.velocity=l.add(this.velocity,new l(0,this.gravity*t/500)),this.gameObject.setPos(l.add(this.gameObject.getPos(),l.mul(this.velocity,this.gravity/100))),this.gameObject.getPos().getY()>=this.land&&(this.gameObject.getPos().setY(this.land),this.velocity=new l(0,-this.gravity))}render(t){}}const y=new Image;y.src="./assets/images/standing_still.png";const E=new Image;E.src="./assets/images/dino_run1.png";const v=new Image;v.src="./assets/images/dino_run2.png";const I=new Image;I.src="./assets/images/duck.png";const A=new Image;A.src="./assets/images/duck_2.png",(new Image).src="./assets/images/standing_still_eye_closed.png";class D extends u{constructor(t,e){super(),this.scaleRatio=t,this.width=58,this.height=62,this.state=1,this.position=new l(10*this.scaleRatio,this.canvas.height-this.height-1.5*t),this.yStandingPosition=this.canvas.height-this.height-1.5*t,this.image=y,this.walkAnimationTimer=200,this.jumpPressed=!1,this.isDuck=!1,this.gravity=20*this.scaleRatio,this.velocity=new l(0,-this.gravity),this.addComponent(new w(this,this.scaleRatio))}update(t,e){switch((g.inputManager.hasKeyDown(g.inputManager.keyCode.SPACE)||g.inputManager.hasKeyDown(g.inputManager.keyCode.UP))&&(this.state=2,this.jumpPressed=!0),this.state){case 1:this.run(e,t);break;case 2:this.jump(t);break;case 3:this.duck(e,t)}}render(){c.drawImage(this.image,this.position.getX(),this.position.getY(),this.width,this.height)}run(t,e){this.isDuck||(this.walkAnimationTimer<=0&&(this.image===E?this.image=v:this.image=E,this.walkAnimationTimer=200),this.walkAnimationTimer-=t*e)}jump(t){this.jumpPressed&&(this.velocity=l.add(this.velocity,new l(0,this.gravity*t/500)),this.position=l.add(this.position,l.mul(this.velocity,this.gravity/100)),this.position.getY()>=this.yStandingPosition&&(this.position.setY(this.yStandingPosition),this.velocity=new l(0,-this.gravity),this.jumpPressed=!1,this.state=1))}duck(t,e){this.isDuck&&(this.walkAnimationTimer<=0&&(this.image===I?this.image=A:this.image=I,this.walkAnimationTimer=200),this.walkAnimationTimer-=t*e)}}const T=new Image;T.src="./assets/images/ground.png";class _ extends u{constructor(t,e){super(),this.width=2400,this.height=24,this.position=new l(0,this.canvas.height-this.height),this.scaleRatio=t,this.speed=e,this.image=T}update(t,e){this.position.setX(this.position.getX()-e*t*this.speed)}render(){c.drawImage(this.image,this.position.getX(),this.position.getY(),this.width,this.height),c.drawImage(this.image,this.position.getX()+this.width,this.position.getY(),this.width,this.height),this.position.getX()<=-this.width&&this.position.setX(0)}}class S{constructor(t,e){this.ctx=t,this.canvas=t.canvas,this.score=0,this.scaleRatio=e}reset(){this.score=0}update(t){this.score+=.01*t}render(){const t=Number(localStorage.getItem(this.HIGH_SCORE_KEY)),e=20*this.scaleRatio,s=15*this.scaleRatio;this.ctx.font=`${s}px serif`,this.ctx.fillStyle="grey";const i=this.canvas.width-60*this.scaleRatio,n=i-100,h=Math.floor(this.score).toString().padStart(5,"0"),a="Hi: "+t.toString().padStart(5,"0");this.ctx.fillText(h,i,e),this.ctx.fillText(a,n,e)}setHighScore(){const t=Number(localStorage.getItem(this.HIGH_SCORE_KEY));this.score>t&&localStorage.setItem(this.HIGH_SCORE_KEY,Math.floor(this.score).toString())}}const P=new Image;P.src="./assets/images/bird_1.png";const M=new Image;M.src="./assets/images/bird_2.png";class b extends u{constructor(t,e){super(),this.width=50,this.height=50,this.position=new l(0,0),this.scaleRatio=t,this.speed=e,this.image=P,this.flyAnimationTimer=100}update(t,e){this.fly(e,t),this.position.setX(this.position.getX()-e*t*this.speed)}fly(t,e){this.flyAnimationTimer<=0&&(this.image===P?this.image=M:this.image=P,this.flyAnimationTimer=200),this.flyAnimationTimer-=t*e}collideWith(t){const e=1.4;return t.x<this.position.getX()+this.width/e&&t.x+t.width/e>this.position.getX()&&t.y<this.position.getY()+this.height/e&&t.y+t.height/e>this.position.getY()}render(){c.drawImage(this.image,this.position.getX(),this.position.getY(),this.width,this.height),this.position.getX()<=-this.width&&this.position.setX(this.width+window.innerWidth)}}const H=new Image;H.src="./assets/images/cloud.png";class k extends u{constructor(t,e){super(),this.width=30*t,this.height=20*t,this.scaleRatio=t,this.position=new l(this.canvas.width-40*this.scaleRatio,this.canvas.height-250*this.scaleRatio),this.speed=e,this.image=H}update(t,e){let s=this.position.getX();s-=t*e*this.speed,this.position.setX(s)}render(){if(c.drawImage(this.image,this.position.getX(),this.position.getY(),this.width,this.height),this.position.getX()<=-this.width){let t=this.width+window.innerWidth;this.position.setX(t)}}}class C{constructor(){this.gameObjects=[]}addGameObject(t){this.gameObjects.push(t)}}g.start(810*n(),200*n(),new class extends C{constructor(){super()}load(){let t=n();this.Player=new D(t,1),this.Ground=new _(t,1),this.Score=new S(t,1),this.Bird=new b(t,1),this.Cloud=new k(t,1),this.addGameObject(this.Player),this.addGameObject(this.Ground),this.addGameObject(this.Bird),this.addGameObject(this.Cloud)}update(t,e){for(let s=0;s<this.gameObjects.length;s++)this.gameObjects[s].update(t,e)}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render()}unload(){this.gameObjects=[]}}),function t(e){const s=Date.now();g.render(),g.update(s-e,.6),e=Date.now(),requestAnimationFrame((()=>t(e)))}(Date.now())})();