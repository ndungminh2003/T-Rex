(()=>{"use strict";const t={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};class e{constructor(){this.keyCode=t,this.keyEvent={keyDown:{},keyUp:{}},this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}static getInstance(){return e.instance||(e.instance=new e),e.instance}start(){window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}hasKeyDown(t){return!0===this.keyEvent.keyDown[t]}hasKeyUp(t){return!0===this.keyEvent.keyUp[t]}handleKeyDown(t){this.hasKeyDown(t.which)||(this.keyEvent.keyDown[t.which]=!0)}handleKeyUp(t){this.keyEvent.keyUp[t.which]=!0,delete this.keyEvent.keyDown[t.which]}}class s{constructor(){}static getInstance(){return s.instance?s.instance:s.instance=new s}loadScene(t){this.currentScene&&this.currentScene.unload(),this.currentScene=t,this.currentScene.load()}update(t,e){this.currentScene.update(t,e)}render(){this.currentScene.render()}getCurrentScene(){return this.currentScene}}class i{constructor(){this.canvas=document.getElementById("game")}static getInstance(){return i.instance||(i.instance=new i),i.instance}getContext(){return this.ctx}getCanvas(){return this.canvas}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}init(t,e){return this.canvas.width=t,this.canvas.height=e,this.canvas}}function n(){const t=Math.min(window.innerHeight,document.documentElement.clientHeight),e=Math.min(window.innerWidth,document.documentElement.clientWidth);return e/t<a.game.GAME_WIDTH/a.game.GAME_HEIGHT?e/a.game.GAME_WIDTH:t/a.game.GAME_HEIGHT}class h{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}getY(){return this.y}setX(t){this.x=t}setY(t){this.y=t}static add(t,e){return new h(t.getX()+e.getX(),t.getY()+e.getY())}static sub(t,e){return new h(t.getX()-e.getX(),t.getY()-e.getY())}static mul(t,e){return new h(t.getX()*e,t.getY()*e)}static distance(t,e){return Math.sqrt(Math.pow(t.getX()-e.getX(),2)+Math.pow(t.getY()-e.getY(),2))}}var a={game:{GAME_WIDTH:800,GAME_HEIGHT:300,GAME_SPEED:1,GAME_SPEED_INCREMENT:1e-5,GROUND_AND_CACTUS_SPEED:.5},player:{PLAYER_WIDTH:58,PLAYER_HEIGHT:62,JUMP_HEIGHT:200,JUMP_SPEED:.6,GRAVITY:.4},ground:{GROUND_WIDTH:2400,GROUND_HEIGHT:24},cactus:{CACTUS_WIDTH:45,CACTUS_HEIGHT:30}};const r=n(),o=i.getInstance().init(300*r,810*r),c=o.getContext("2d");new h(0,o.height-1050);class g{constructor(){this.isActive=!0,this.isEnabled=!0,this.gameCore=T,this.canvas=T.canvas.getCanvas()}setToggleActive(t){t&&!this.isEnabled?this.isEnabled=!0:!t&&this.isEnabled&&(this.isEnabled=!1)}reset(){}}class d extends g{constructor(t=new h(0,0),e=0){super(),this.components=[],this.position=t,this.depth=e}getPos(){return this.position}setPos(t){this.position=t}getWidth(){return this.width}getHeight(){return this.height}setWidth(t){this.width=t}setHeight(t){this.height=t}getDepth(){return this.depth}setDepth(t){this.depth=t}setToggleActive(t){if(t&&!this.isEnabled){for(let t of this.components)t.setToggleActive(!0);this.isEnabled=!0}else if(!t&&this.isEnabled){for(let t of this.components)t.setToggleActive(!1);this.isEnabled=!1}}addComponent(t){this.components.push(t)}getComponent(t){for(let e of this.components)if(e.getName()===t)return e}}class m extends d{constructor(){super()}getImage(){return this.image}setImage(t){this.image=t}}class l extends g{constructor(t){super(),this.gameObject=t,this.gameObject.addComponent(this)}getName(){return this.name}setName(t){this.name=t}}class p extends l{constructor(t,e){super(t),this.gravity=10*e,this.velocity=new h(0,-this.gravity),this.land=this.canvas.height-this.gameObject.getHeight()-1.5*e,this.name="Physic"}update(t){this.velocity=h.add(this.velocity,new h(0,this.gravity/t)),this.gameObject.setPos(h.add(this.gameObject.getPos(),h.mul(this.velocity,this.gravity/t))),this.gameObject.getPos().getY()>=this.land&&(this.gameObject.getPos().setY(this.land),this.velocity=new h(0,-this.gravity))}render(t){}}const u=new Image;u.src="./assets/images/standing_still.png";const w=new Image;w.src="./assets/images/dino_run1.png";const y=new Image;y.src="./assets/images/dino_run2.png";const E=new Image;E.src="./assets/images/crouch_1.png";const S=new Image;S.src="./assets/images/crouch_2.png";const b=new Image;b.src="./assets/images/standing_still_eye_closed.png";class I extends m{constructor(t,e){super(),this.scaleRatio=n(),this.image=u,this.width=this.image.width,this.height=this.image.height,this.state=1,this.position=new h(10*this.scaleRatio,this.canvas.height-this.height-1.5*t),this.walkAnimationTimer=200,this.physic=new p(this,t)}update(t,e){switch(this.state){case 1:T.inputManager.hasKeyDown(T.inputManager.keyCode.SPACE)||T.inputManager.hasKeyDown(T.inputManager.keyCode.UP)?this.state=2:T.inputManager.hasKeyDown(T.inputManager.keyCode.DOWN)&&(this.image=E,this.state=4),this.run(t,e),this.resetPos();break;case 2:this.image=b,T.inputManager.hasKeyDown(T.inputManager.keyCode.DOWN)&&(this.physic.velocity.setY(this.physic.velocity.getY()+this.physic.gravity*t/60),this.state=3),this.physic.update(t),this.physic.velocity.getY()>=0&&(this.state=3);break;case 3:this.physic.update(t),T.inputManager.hasKeyDown(T.inputManager.keyCode.DOWN)&&(this.physic.velocity.setY(this.physic.velocity.getY()+this.physic.gravity*t/60),this.state=3),this.position.getY()>=this.physic.land&&(this.state=1,this.position.setY(this.physic.land),this.physic.velocity.setY(10*this.scaleRatio));break;case 4:T.inputManager.hasKeyDown(T.inputManager.keyCode.DOWN)||(this.state=1,this.image=u,this.resetPos()),this.duck(t,e),this.resetPos()}}resetPos(){this.width=this.image.width,this.height=this.image.height,this.position=new h(this.position.getX(),this.canvas.height-this.height-1.5*this.scaleRatio)}render(){c.drawImage(this.image,this.position.getX(),this.position.getY(),this.width,this.height)}run(t,e){this.walkAnimationTimer<=0&&(this.image===w?this.image=y:this.image=w,this.walkAnimationTimer=200),this.walkAnimationTimer-=t*e}duck(t,e){4===this.state&&(this.walkAnimationTimer<=0&&(this.image===E?this.image=S:this.image=E,this.walkAnimationTimer=200),this.walkAnimationTimer-=t*e)}}const M=new Image;M.src="./assets/images/ground.png";class v extends m{constructor(t,e){super(),this.width=2400,this.height=24,this.position=new h(0,this.canvas.height-this.height),this.scaleRatio=t,this.image=M}update(t,e){this.position.setX(this.position.getX()-e*t)}render(){c.drawImage(this.image,this.position.getX(),this.position.getY(),this.width,this.height),c.drawImage(this.image,this.position.getX()+this.width,this.position.getY(),this.width,this.height),this.position.getX()<=-this.width&&this.position.setX(0)}}class D{constructor(){this.gameObjects=[]}addGameObject(t){this.gameObjects.push(t)}}const C=new Image;C.src="./assets/images/cloud.png";class A extends m{constructor(t,e){super(),this.width=30*t,this.height=20*t,this.scaleRatio=t,this.position=new h(this.canvas.width-40*this.scaleRatio,this.canvas.height-250*this.scaleRatio),this.speed=e,this.image=C}update(t,e){let s=this.position.getX();s-=e*t*this.speed*.5,this.position.setX(s)}render(){if(c.drawImage(this.image,this.position.getX(),this.position.getY(),this.width,this.height),this.position.getX()<=-this.width){let t=this.width+window.innerWidth;this.position.setX(t)}}}class O extends D{load(){let t=n();this.player=new I(t,1),this.ground=new v(t,1),this.cloud=new A(t,1),this.addGameObject(this.player),this.addGameObject(this.ground),this.addGameObject(this.cloud)}update(t,e){}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render()}unload(){this.gameObjects=[]}}class P{constructor(){this.state=1,this.setCurrentScene(new O),this.canvas=i.getInstance(),this.inputManager=e.getInstance(),this.sceneManager=s.getInstance()}static getInstacne(){return P.instance?P.instance:P.instance=new P}start(t,e,s){this.canvas.init(t,e),this.inputManager.start(),this.sceneManager.loadScene(s)}clearScreen(){c.fillStyle="white",c.fillRect(0,0,o.width,o.height)}update(t,e){this.sceneManager.update(t,e)}render(){this.clearScreen(),this.sceneManager.render()}getCurrentScene(){return this.currentScene}setCurrentScene(t){this.currentScene=t}}const T=new P;class _ extends m{constructor(t){super()}update(t,e){this.position.setX(this.position.getX()-e*t*1.3)}collideWith(t){const e=1.4;return t.getPos().getX()<this.position.getX()+this.width/e&&t.getPos().getX()+t.getWidth()/e>this.position.getX()&&t.getPos().getY()<this.position.getY()+this.height/e&&t.getPos().getY()+t.getHeight()/e>this.position.getY()}render(){c.drawImage(this.image,this.getPos().getX(),this.getPos().getY(),this.width,this.height),this.getPos().getX()<=-this.width&&this.getPos().setX(this.width+window.innerWidth)}}class G extends _{constructor(t,e,s){super(t);let i=new Image;i.src="./assets/images/cactus_"+String(Math.floor(3*Math.random())+1)+".png",this.image=i,this.width=this.image.width,this.height=this.image.height,this.position=new h(1.5*this.canvas.width,this.canvas.height-this.height),this.depth=s}update(t,e){this.position.setX(this.position.getX()-e*t)}}class k extends d{constructor(t){super(),this.score=0,this.scaleRatio=t}reset(){this.score=0}getScore(){return this.score}update(t){this.score+=.01*t}render(){const t=Number(localStorage.getItem(this.HIGH_SCORE_KEY)),e=20*this.scaleRatio,s=15*this.scaleRatio;c.font=`${s}px serif`,c.fillStyle="grey";const i=this.canvas.width-60*this.scaleRatio,n=i-150,h=Math.floor(this.score).toString().padStart(5,"0"),a="Hi: "+t.toString().padStart(5,"0");c.fillText(h,i,e),c.fillText(a,n,e)}setHighScore(){const t=Number(localStorage.getItem(this.HIGH_SCORE_KEY));this.score>t&&localStorage.setItem(this.HIGH_SCORE_KEY,Math.floor(this.score).toString())}}const f=new Image;f.src="./assets/images/bird_1.png";const H=new Image;H.src="./assets/images/bird_2.png";class Y extends _{constructor(t,e,s,i){super(t),this.width=50,this.height=50,this.position=s,this.scaleRatio=t,this.speed=e,this.depth=i,this.image=f,this.flyAnimationTimer=100}update(t,e){this.fly(e,t),super.update(t,e)}fly(t,e){this.flyAnimationTimer<=0&&(this.image===f?this.image=H:this.image=f,this.flyAnimationTimer=300),this.flyAnimationTimer-=t*e}}class j extends D{constructor(){super(),this.enemies=[],this.birds=[],this.currentBirdIndex=0,this.enemySpawnInterval=2e3,this.lastEnemySpawnTime=0,this.birdSpawnPositions=[new h(30,150),new h(100,200),new h(50,220)]}load(){let t=n();this.player=new I(t,1),this.ground=new v(t,1),this.score=new k(t),this.cloud=new A(t,1),this.birds.push(new Y(t,1,this.birdSpawnPositions[1],14)),this.addGameObject(this.ground),this.addGameObject(this.cloud),this.addGameObject(this.score),this.addGameObject(this.player),this.loadBirds(t),this.loadEnemies()}loadBirds(t){for(let e=0;e<this.birdSpawnPositions.length;e++){let s=new Y(t,1,this.birdSpawnPositions[e],14);this.birds.push(s)}}loadEnemies(){for(let t=0;t<this.enemies.length;t++){let e=this.enemies[t];this.addGameObject(e)}}spawnEnemy(){let t,e=n();Math.random()>.5&&(t=new G(e,1,13),this.enemies.push(t),this.addGameObject(t))}update(t,e){const s=performance.now();s-this.lastEnemySpawnTime>this.enemySpawnInterval&&(this.spawnEnemy(),this.lastEnemySpawnTime=s);for(let s=0;s<this.gameObjects.length;s++)this.gameObjects[s].update(t,e);this.checkCollisions()}checkCollisions(){for(let t of this.enemies)if(t.collideWith(this.player)){this.unload(),T.state=3;break}}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render()}unload(){this.gameObjects=[],this.enemies=[],this.currentBirdIndex=0}}const X=new Image;X.src="./assets/images/replay.png";class x extends D{load(){let t=n();this.player=new I(t,1),this.ground=new v(t,1),this.score=new k(t),this.cloud=new A(t,1),this.addGameObject(this.player),this.addGameObject(this.ground),this.addGameObject(this.score),this.addGameObject(this.cloud),this.gameOverText="GAME OVER!"}update(t,e){}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render();this.renderGameOverText()}renderGameOverText(){c.font="48px serif",c.fillStyle="grey",c.textAlign="center",c.fillText(this.gameOverText,window.innerWidth/2,window.innerHeight/3),c.drawImage(X,window.innerWidth/2-28,window.innerHeight/3+20)}unload(){this.gameObjects=[]}}class R{constructor(){this.gameCore=T,this.gameCore.start(810*n(),300*n(),new j),this.gameSpeed=.7}updateGameSpeed(){this.gameSpeed+=1e-4}static getInstance(){return R.instance?R.instance:R.instance=new R}update(t,e){switch(this.gameCore.state){case 1:(T.inputManager.hasKeyDown(T.inputManager.keyCode.SPACE)||T.inputManager.hasKeyDown(T.inputManager.keyCode.UP))&&(this.gameCore.state=2),this.gameCore.update(0,0);break;case 2:this.updateGameSpeed(),this.gameCore.update(t,this.gameSpeed);break;case 3:this.gameCore.state=3,this.gameCore.sceneManager.loadScene(new x),(T.inputManager.hasKeyDown(T.inputManager.keyCode.SPACE)||T.inputManager.hasKeyDown(T.inputManager.keyCode.UP))&&(this.gameCore.state=2,this.gameCore.sceneManager.loadScene(new j)),this.gameCore.update(0,0)}}render(){this.gameCore.render()}}const U=R.getInstance();!function t(e){const s=Date.now();U.render(),U.update(s-e,.6),e=Date.now(),requestAnimationFrame((()=>t(e)))}(Date.now())})();