(()=>{"use strict";const t={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38};class e{constructor(){this.keyCode=t,this.keyEvent={keyDown:{},keyUp:{}},this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this)}static getInstance(){return e.instance||(e.instance=new e),e.instance}start(){window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp)}hasKeyDown(t){return!0===this.keyEvent.keyDown[t]}hasKeyUp(t){return!0===this.keyEvent.keyUp[t]}handleKeyDown(t){this.hasKeyDown(t.which)||(this.keyEvent.keyDown[t.which]=!0)}handleKeyUp(t){this.keyEvent.keyUp[t.which]=!0,delete this.keyEvent.keyDown[t.which]}}class s{constructor(){this.canvas=document.getElementById("game")}static getInstance(){return s.instance||(s.instance=new s),s.instance}getContext(){return this.ctx}getCanvas(){return this.canvas}getWidth(){return this.canvas.width}getHeight(){return this.canvas.height}init(t,e){return this.canvas.width=t,this.canvas.height=e,this.canvas}}const i=s.getInstance().init(600,1400),n=i.getContext("2d");class a{constructor(){this.isActive=!0,this.isEnabled=!0,this.gameCore=L,this.canvas=L.canvas.getCanvas()}setToggleActive(t){t&&!this.isEnabled?this.isEnabled=!0:!t&&this.isEnabled&&(this.isEnabled=!1)}reset(){}}class h extends a{constructor(t){super(),this.gameObject=t,this.gameObject.addComponent(this)}getName(){return this.name}setName(t){this.name=t}}class r extends h{constructor(t){super(t),this.width=t.getWidth(),this.height=t.getHeight(),this.pos=t.getPos(),this.name="Collider"}getWidth(){return this.width}getHeight(){return this.height}setWidth(t){this.width=t}setHeight(t){this.height=t}getPosition(){return this.pos}setPosition(t){this.pos=t}isCollidingWith(t){return t.getPosition().getX()<this.pos.getX()+this.width&&t.getPosition().getX()+t.getWidth()>this.pos.getX()&&t.getPosition().getY()<this.pos.getY()+this.height&&t.getHeight()+t.getPosition().getY()>this.pos.getY()}update(t,e){}render(t){}}class o{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}getY(){return this.y}setX(t){this.x=t}setY(t){this.y=t}static add(t,e){return new o(t.getX()+e.getX(),t.getY()+e.getY())}static sub(t,e){return new o(t.getX()-e.getX(),t.getY()-e.getY())}static mul(t,e){return new o(t.getX()*e,t.getY()*e)}static distance(t,e){return Math.sqrt(Math.pow(t.getX()-e.getX(),2)+Math.pow(t.getY()-e.getY(),2))}}class g extends a{constructor(t=new o(0,0),e=0){super(),this.components=[],this.position=t,this.depth=e}getPos(){return this.position}setPos(t){this.position=t}getWidth(){return this.width}getHeight(){return this.height}setWidth(t){this.width=t}setHeight(t){this.height=t}getDepth(){return this.depth}setDepth(t){this.depth=t}setToggleActive(t){if(t&&!this.isEnabled){for(let t of this.components)t.setToggleActive(!0);this.isEnabled=!0}else if(!t&&this.isEnabled){for(let t of this.components)t.setToggleActive(!1);this.isEnabled=!1}}addComponent(t){this.components.push(t)}getComponent(t){for(let e of this.components)if(e.getName()===t)return e}}class c extends g{constructor(){super()}getImage(){return this.image}setImage(t){this.image=t}render(){n.drawImage(this.image,this.position.getX(),this.position.getY())}}class d extends h{constructor(t){super(t),this.gravity=.00375,this.velocity=new o(0,0),this.land=this.canvas.height-this.gameObject.getHeight(),this.name="Physic"}update(t){this.velocity=o.add(this.velocity,new o(0,this.gravity*t)),this.gameObject.setPos(o.add(this.gameObject.getPos(),new o(0,this.velocity.getY()*t))),this.gameObject.getPos().getY()>=this.land&&(this.gameObject.getPos().setY(this.land),this.velocity=new o(0,0))}render(t){}}class m extends h{constructor(t,e){super(t),this.name="Animation",this.animatiomTimer=200,this.animationFrame={},this.animationFrameIndex=0,this.sprite=e}getAnimationName(){return this.animationNameRunning}addAnimationFrame(t,e){this.animationFrame[t]||(this.animationFrame[t]=[]),this.animationFrame[t].push(e)}play(t,e,s){t!==this.animationNameRunning&&(this.animationNameRunning=t,this.animationFrameIndex=0),this.update(e,s)}update(t,e){this.animatiomTimer<=0&&(this.sprite.setImage(this.animationFrame[this.animationNameRunning][this.animationFrameIndex]),this.animationFrameIndex=(this.animationFrameIndex+1)%this.animationFrame[this.animationNameRunning].length,this.animatiomTimer=100),this.animatiomTimer-=t*e}render(t){}}class u{constructor(t){this.dinosaur=t}update(t,e){}}const p=new Image;p.src="./assets/images/dino_run1.png";class w extends u{constructor(t){super(t)}update(t,e){this.dinosaur.getPhysic().update(t),L.inputManager.hasKeyDown(L.inputManager.keyCode.DOWN)&&(this.dinosaur.getPhysic().velocity.setY(this.dinosaur.getPhysic().velocity.getY()+this.dinosaur.getPhysic().gravity*t*2),this.dinosaur.changeState(new w(this.dinosaur))),this.dinosaur.getPos().getY()>=this.dinosaur.getPhysic().land&&(this.dinosaur.setImage(p),this.dinosaur.changeState(new b(this.dinosaur)))}}const l=new Image;l.src="./assets/images/standing_still.png";class y extends u{constructor(t){super(t)}update(t,e){L.inputManager.hasKeyDown(L.inputManager.keyCode.DOWN)||(this.dinosaur.setImage(l),this.dinosaur.changeState(new b(this.dinosaur)),this.dinosaur.resetPos()),this.dinosaur.getAnimation().play("CROUCH",t,e),this.dinosaur.resetPos()}}const S=new Image;S.src="./assets/images/crouch_1.png";class C extends u{constructor(t){super(t)}update(t,e){L.inputManager.hasKeyDown(L.inputManager.keyCode.DOWN)&&(this.dinosaur.getPhysic().velocity.setY(this.dinosaur.getPhysic().velocity.getY()+this.dinosaur.getPhysic().gravity*t*2),this.dinosaur.changeState(new w(this.dinosaur))),L.inputManager.hasKeyDown(L.inputManager.keyCode.DOWN)&&L.inputManager.hasKeyDown(L.inputManager.keyCode.SPACE)&&(this.dinosaur.setImage(S),this.dinosaur.resetPos(),this.dinosaur.changeState(new y(this.dinosaur))),this.dinosaur.getPhysic().update(t),this.dinosaur.getPhysic().velocity.getY()>=0&&this.dinosaur.changeState(new w(this.dinosaur))}}const M=new Image;M.src="./assets/images/standing_still_eye_closed.png";const I=new Image;I.src="./assets/images/crouch_1.png";class b extends u{constructor(t){super(t)}update(t,e){this.dinosaur.getAnimation().play("RUNNING",t,e),L.inputManager.hasKeyDown(L.inputManager.keyCode.SPACE)||L.inputManager.hasKeyDown(L.inputManager.keyCode.UP)?(this.dinosaur.setImage(M),this.dinosaur.changeState(new C(this.dinosaur)),this.dinosaur.getPhysic().velocity.setY(-1.2)):L.inputManager.hasKeyDown(L.inputManager.keyCode.DOWN)&&(this.dinosaur.setImage(I),this.dinosaur.changeState(new y(this.dinosaur)),this.dinosaur.resetPos()),this.dinosaur.resetPos()}}const E=new Image;E.src="./assets/images/standing_still.png";const P=new Image;P.src="./assets/images/dino_run1.png";const O=new Image;O.src="./assets/images/dino_run2.png";const D=new Image;D.src="./assets/images/crouch_1.png";const v=new Image;v.src="./assets/images/crouch_2.png";const X=new Image;X.src="./assets/images/die.png";const N=new Image;N.src="./assets/images/die_1.png";class j extends c{constructor(){super(),this.currentState=new b(this),this.image=E,this.width=88,this.height=94,this.position=new o(10,this.canvas.height-this.height),this.physic=new d(this),this.animation=new m(this,this),this.animation.addAnimationFrame("RUNNING",P),this.animation.addAnimationFrame("RUNNING",O),this.animation.addAnimationFrame("CROUCH",D),this.animation.addAnimationFrame("CROUCH",v),this.animation.addAnimationFrame("DIE",X),this.animation.addAnimationFrame("DIE",N),this.collider=new r(this)}update(t,e){this.position.getX()<=40&&(this.currentState instanceof b||this.currentState instanceof y)&&(this.currentState instanceof b?this.animation.play("RUNNING",t,.7):this.animation.play("CROUCH",t,.7),this.position.setX(this.position.getX()+1)),this.currentState.update(t,e)}getPhysic(){return this.physic}getAnimation(){return this.animation}setImage(t){this.image=t}changeState(t){this.currentState=t}getCurrentState(){return this.currentState}resetPos(){this.width=this.image.width,this.height=this.image.height,this.position=new o(this.position.getX(),this.canvas.height-this.height)}}const f=new Image;f.src="./assets/images/ground.png";class A extends c{constructor(t){super(),this.pos=t,this.image=f,this.width=2400,this.height=24,this.position=new o(0+t.getX(),this.canvas.height-this.height)}update(t,e){this.position.setX(this.position.getX()-e*t),this.position.getX()<=-this.width&&0==this.pos.getX()&&this.position.setX(0),this.position.getX()<=0&&2400==this.pos.getX()&&this.position.setX(2400)}}class x{constructor(){this.gameObjects=[]}addGameObject(t){this.gameObjects.push(t)}getGameObjects(){return this.gameObjects}}const G=new Image;G.src="./assets/images/cloud.png";class Y extends c{constructor(t,e){super(),this.velocity=e,this.position=t,this.width=G.width,this.height=G.height,this.image=G}update(t,e){let s=this.position.getX();if(s-=e*t*e*.5+this.velocity.getX(),this.position.setX(s),this.position.getX()<=-this.width){let t=this.width+window.innerWidth;this.position.setX(t)}}}class U extends c{constructor(t,e){super(),this.digit=e,this.position=t,this.image=new Image,this.setDigit(e)}setDigit(t){this.digit=t,this.image.src=`./assets/images/number/${this.digit}_digit.png`}update(t,e){throw new Error("Method not implemented.")}}const k="highScore";class _ extends g{constructor(t,e=5){super(),this.length=e,this.listDigit=[],this.position=t,this.highScore=window.Number(localStorage.getItem(k))||0,this.incrementCounter=0;for(let s=0;s<e;s++)this.listDigit.push(new U(new o(this.position.getX()+25*s,t.getY()),0));this.num=0,this.formattedNumber=this.stringToNumber(this.num)}stringToNumber(t){return t.toLocaleString("en-US",{minimumIntegerDigits:this.length,useGrouping:!1})}setNumber(t){this.num=t,this.formattedNumber=this.stringToNumber(this.num);for(let t=0;t<this.length;t++)this.listDigit[t].setDigit(parseInt(this.formattedNumber[t]));this.num>this.highScore&&(this.highScore=this.num,localStorage.setItem(k,this.highScore.toString()))}getHighScore(){return this.highScore}update(t,e){this.incrementCounter+=t*e*.02,this.incrementCounter>=1&&(this.incrementCounter=0,this.num+=1,this.setNumber(this.num))}render(){for(let t of this.listDigit)t.render()}}class F extends c{constructor(t,e){super(),this.character=e,this.position=t,this.image=new Image,this.image.src=`./assets/images/${this.character}_character.png`}setCharacter(t){this.character=t,this.image.src=`./assets/images/${this.character}_character.png`}update(t,e){throw new Error("Method not implemented.")}}class K extends g{constructor(t){super(),this.position=t,this.hChar=new F(new o(this.position.getX(),this.position.getY()),"H"),this.iChar=new F(new o(this.position.getX()+22,this.position.getY()),"I"),this.highScore=Number(localStorage.getItem("highScore"))||0}update(t,e){}render(){this.hChar.render(),this.iChar.render();const t=this.highScore.toString().padStart(5,"0");let e=65;for(let s=0;s<t.length;s++){const i=t[s];new U(new o(this.position.getX()+e,this.position.getY()),parseInt(i)).render(),e+=25}}}const W=new Image;W.src="./assets/images/sun.png";class T extends c{constructor(t,e){super(),this.velocity=e,this.position=t,this.width=W.width,this.height=W.height,this.image=W}update(t,e){let s=this.position.getX();if(s-=e*t*e*.5+this.velocity.getX(),this.position.setX(s),this.position.getX()<=-this.width){let t=this.width+window.innerWidth;this.position.setX(t)}}}class H extends x{load(){this.ground=new A(new o(0,0)),this.player=new j,this.score=new _(new o(i.width-150,50),5),this.highScore=new K(new o(i.width-400,50)),this.cloud=new Y(new o(i.width-900,100),new o(-.8,0)),this.cloud3=new Y(new o(i.width-200,130),new o(-.6,0)),this.cloud1=new Y(new o(i.width-1200,180),new o(-.4,0)),this.cloud2=new Y(new o(i.width-500,220),new o(-.1,0)),this.sun=new T(new o(i.width-700,80),new o(-2,0)),this.addGameObject(this.sun),this.addGameObject(this.player),this.addGameObject(this.ground),this.addGameObject(this.cloud),this.addGameObject(this.cloud1),this.addGameObject(this.cloud2),this.addGameObject(this.cloud3),this.addGameObject(this.score),this.addGameObject(this.highScore)}update(t,e){}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render()}unload(){}}class R{constructor(){this.setCurrentScene(new H),this.canvas=s.getInstance(),this.inputManager=e.getInstance()}static getInstacne(){return R.instance?R.instance:R.instance=new R}start(t,e,s){this.canvas.init(t,e),this.inputManager.start(),this.currentScene.load()}clearScreen(){n.fillStyle="white",n.fillRect(0,0,i.width,i.height)}update(t,e){this.currentScene.update(t,e)}render(){this.clearScreen(),this.currentScene.render()}changeScene(t){this.currentScene.unload(),this.setCurrentScene(t),this.currentScene.load()}getCurrentScene(){return this.currentScene}setCurrentScene(t){this.currentScene=t}}const L=new R;class B extends x{constructor(){super()}load(){this.player=new j,this.ground=new A(new o(0,0)),this.ground1=new A(new o(2400,0)),this.score=new _(new o(i.width-150,50),5),this.cloud=new Y(new o(i.width-900,100),new o(-.8,0)),this.cloud3=new Y(new o(i.width-200,130),new o(-.9,0)),this.cloud1=new Y(new o(i.width-1200,180),new o(-.6,0)),this.cloud2=new Y(new o(i.width-500,220),new o(-.3,0)),this.sun=new T(new o(i.width-700,80),new o(-2,0)),this.highScore=new K(new o(i.width-400,50)),this.addGameObject(this.sun),this.addGameObject(this.highScore),this.addGameObject(this.ground),this.addGameObject(this.ground1),this.addGameObject(this.cloud),this.addGameObject(this.cloud1),this.addGameObject(this.cloud2),this.addGameObject(this.cloud3),this.addGameObject(this.score),this.addGameObject(this.player)}update(t,e){for(let s=0;s<this.gameObjects.length;s++)this.gameObjects[s].update(t,e)}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render()}unload(){}}class $ extends c{constructor(){super(),this.collider=new r(this)}update(t,e){this.position.setX(this.position.getX()-e*t)}}const q=new Image;q.src="./assets/images/bird_1.png";const V=new Image;V.src="./assets/images/bird_2.png";class z extends ${constructor(t,e){super(),this.position=t,this.depth=e,this.image=q,this.width=q.width,this.height=q.height,this.animation=new m(this,this),this.animation.addAnimationFrame("FLY",q),this.animation.addAnimationFrame("FLY",V)}update(t,e){this.fly(t,e),this.position.setX(this.position.getX()-e*t*1.3)}fly(t,e){this.animation.play("FLY",t,e)}}class J extends ${constructor(t){super(),this.depth=t;let e=new Image;e.src="./assets/images/cactus_"+String(Math.floor(3*Math.random())+1)+".png",this.image=e,this.width=this.image.width,this.height=this.image.height,this.position=new o(1.5*this.canvas.width,this.canvas.height-this.height)}update(t,e){this.position.setX(this.position.getX()-e*t),this.getPos().getX()<=-this.width&&this.getPos().setX(this.width+window.innerWidth)}}class Q{constructor(){this.enemies=[],this.maxEnemies=6,this.currentEnemies=0}static getInstance(){return Q.instance||(Q.instance=new Q),Q.instance}generateEnemy(t){let e=600*Math.random();for(;e<=150||e>=520;)e=600*Math.random();const s=new o(i.width,e),n=new z(s,t);if(this.enemies.push(n),this.currentEnemies++,e<=400){const e=new J(t);this.enemies.push(e),this.currentEnemies++}}update(t,e){for(let s=0;s<this.enemies.length;s++){const i=this.enemies[s];i.update(t,e),i.getPos().getX()<-i.getWidth()&&(this.removeEnemy(i),s--)}}clearEnemies(){this.enemies=[],this.currentEnemies=0}removeEnemy(t){const e=this.enemies.indexOf(t);e>-1&&(this.enemies.splice(e,1),this.currentEnemies--)}render(){for(const t of this.enemies)t.render()}}const Z=Q.getInstance();class tt{constructor(t){this.gameManager=t}}class et extends tt{constructor(t){super(t)}update(t){(this.gameManager.gameCore.inputManager.hasKeyDown(this.gameManager.gameCore.inputManager.keyCode.SPACE)||this.gameManager.gameCore.inputManager.hasKeyDown(this.gameManager.gameCore.inputManager.keyCode.UP))&&(this.gameManager.changeState(new ht(this.gameManager)),Z.enemies=[],this.gameManager.gameCore.changeScene(new B),this.gameManager.resetGame()),this.gameManager.gameCore.update(0,0)}}const st=new Image;st.src="./assets/images/replay.png";const it=new Image;it.src="./assets/images/game_over.png";class nt extends x{constructor(t){super(),this.gameObjects=t}load(){}update(t,e){}render(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].render();this.renderGameOver()}renderGameOver(){n.drawImage(it,i.width/2-180,i.height/2-50),n.drawImage(st,i.width/2-25,i.height/2)}unload(){for(let t=0;t<this.gameObjects.length;t++)this.gameObjects[t].setToggleActive(!1)}}const at=new Image;at.src="./assets/images/die.png";class ht extends tt{constructor(t){super(t)}update(t){this.gameManager.updateGameSpeed(),this.gameManager.gameCore.update(t,this.gameManager.gameSpeed),this.gameManager.timeSinceLastEnemy+=t,this.gameManager.gameCore.getCurrentScene().getGameObjects();const e=this.gameManager.gameCore.getCurrentScene().getGameObjects().find((t=>t instanceof j)),s=e.getComponent("Collider");s&&Z.enemies.forEach((t=>{const i=t.getComponent("Collider");i.setHeight(t.getHeight()),i.setWidth(t.getWidth()),i.setPosition(t.getPos()),s.setHeight(e.getHeight()),s.setWidth(e.getWidth()),s.setPosition(e.getPos()),s.isCollidingWith(i)&&(e.setImage(at),e.getCurrentState()instanceof y&&e.resetPos(),this.gameManager.changeState(new et(this.gameManager)),this.gameManager.gameCore.changeScene(new nt(this.gameManager.gameCore.getCurrentScene().getGameObjects())),this.gameManager.gameCore.getCurrentScene().unload())})),this.gameManager.timeSinceLastEnemy>=this.gameManager.minTimeBetweenEnemies&&(Z.generateEnemy(this.gameManager.gameSpeed),this.gameManager.timeSinceLastEnemy=0),Z.update(t,this.gameManager.gameSpeed)}}class rt extends tt{constructor(t){super(t)}update(t){(this.gameManager.gameCore.inputManager.hasKeyDown(this.gameManager.gameCore.inputManager.keyCode.SPACE)||this.gameManager.gameCore.inputManager.hasKeyDown(this.gameManager.gameCore.inputManager.keyCode.UP))&&(this.gameManager.changeState(new ht(this.gameManager)),this.gameManager.gameCore.changeScene(new B)),this.gameManager.gameCore.update(0,0)}}(new Image).src="./assets/images/die.png";class ot{constructor(){this.currentState=new rt(this),this.gameCore=L,this.gameCore.start(1400,600,new B),this.gameSpeed=.7,this.timeSinceLastEnemy=0,this.minTimeBetweenEnemies=3e3}static getInstance(){return ot.instance||(ot.instance=new ot),ot.instance}updateGameSpeed(){this.gameSpeed+=1e-4}update(t){this.currentState.update(t)}resetGame(){this.gameSpeed=.7}render(){this.gameCore.render(),Z.render()}changeState(t){this.currentState=t}}const gt=ot.getInstance();!function t(e){const s=Date.now();gt.render(),gt.update(s-e),e=Date.now(),requestAnimationFrame((()=>t(e)))}(Date.now())})();